---
title: "algorithm"
author: "Joseph Wang"
date: "2020/1/30"
header-includes:
   - \usepackage{amsmath,bm}
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Algorithm
1. parameters:
  - $\sigma^2$
  - $\bm{M} \succcurlyeq \bm{0}$
  - $K > 0$
  - $\delta = \frac{\tau^2}{\sigma^2}$
  - $\bm{\theta} = (\bm{\beta}, \nu, \rho)'$
    - $\bm{\beta} \in \mathcal{R}^L$
    - $\nu > 0$
    - $\rho > 0$

2. objective function
  $$n\log{2\pi} + \frac{\bm{z}'\bm{R}^{-1}(\bm{\theta},\delta)\bm{z}}{\sigma^2} + \sum_{k=1}^K\left\{\log(\eta_{K,k}+\sigma^2)-\frac{\eta_{K,k}}{\sigma^2(\eta_{K,k}+\sigma^2)}\right\} +(n-K)\log(\sigma^2)+\log|\bm{R}(\bm{\theta},\delta)|$$

3. Estimation
- $$\small
\hat{\sigma}^{2} = \max\left\{ \frac{1}{n-K^{*}}\left(\bm{z}^{\top}\bm{R}^{-1}(\bm{\theta},\delta)\textbf{z}-\sum_{k=0}^{K^{*}}\eta_{K,k}\right),0\right\}
$$

- $$\small
\bm\hat{M}_{K}=\left[\bm{F}_{K}^{\top}\bm{R}^{-1}(\bm{\theta},\delta)\bm{F}_{K}\right]{}^{-1/2}\bm{U}\mathrm{diag}\big(\hat{\eta}_{K,1},\dots,\hat{\eta}_{K,K}\big)\bm{U}^{\top}\left[\bm{F}_{K}^{\top}\bm{R}^{-1}(\bm{\theta},\delta)\bm{F}_{K}\right]{}^{-1/2}
$$
    - $\textbf{R}(\bm{\theta},\delta) := \delta\mbox{Cov}(\bm{\xi}) +\bm{I}_n$
    
    - $\textbf{R}({a},\lambda) := \frac{1}{\lambda}{\Phi}\textbf{B}^{-1}(a)\textbf{B}^{-\top}(a){\Phi}^{\top}+\textbf{I}_{n}$

  - $\textbf{R}^{-1}(a,\lambda)=\textbf{I}_{n}-\Phi\left(\Phi^{\top}\Phi+\lambda\textbf{B}^{\top}(a)\textbf{B}(a)\right)^{-1}\Phi^{\top}$
  - Wendland basis: $\Phi = ({\bf{\phi}}(\textbf{s}_1), \dots, {\bf{\phi}}(\textbf{s}_n))^\top$
    
    - ${\bf{\phi}}(\textbf{s}) = (\phi_1(\textbf{s}), \dots, \phi_J(\textbf{s}))^\top$ 
    - ${\phi}_j(\textbf{s}) = \frac{1}{3}\left(1-\frac{\|\textbf{s}-\textbf{c}_j\|}{\Delta_j}\right)^6\left(35\frac{\|\textbf{s}-\textbf{c}_j\|^2}{\Delta_j}+18\frac{\|\textbf{s}-\textbf{c}_j\|}{\Delta_j}+3\right)I(\|\textbf{s}-\textbf{c}_j\|\leq \Delta_j)$ 




3.

$$\small
{a}^{(k+1)} = \arg\min_a \frac{\textbf{z}^{\top}\textbf{R}^{-1}(a,\lambda^{(k)})\textbf{z}}{\left({\sigma}^{2}\right)^{(k)} }+\log|\Phi^{\top}\Phi+\lambda^{(k)}\textbf{B}^{\top}(a)\textbf{B}(a)|-\log|\textbf{B}^{\top}(a)\textbf{B}(a)|,
$$

4.
$$\small
{\lambda}^{(k+1)} = \arg\min_\lambda \frac{\textbf{z}^{\top}\textbf{R}^{-1}({a}^{(k)},\lambda^{(k)})\textbf{z}}{\left({\sigma}^{2}\right)^{(k)} }-J\log\lambda+\log|\Phi^{\top}\Phi+\lambda\textbf{B}^{\top}({a}^{(k)})\textbf{B}({a}^{(k)})|
$$


- Ref: https://asreml.kb.vsni.co.uk/wp-content/uploads/sites/3/2018/02/ASReml-R-3-Reference-Manual.pdf